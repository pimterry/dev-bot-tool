# DevBot Tool [![Build Status](https://travis-ci.org/pimterry/dev-bot-tool.png)](https://travis-ci.org/pimterry/dev-bot-tool)

**[DevBot](https://github.com/pimterry/dev-bot) is a framework to build chat-bot-based developer tooling.**

This is a command line tool to manage your DevBots, so you can run them locally, host them for free (typically) on AWS Lambda, and generally get things done.

Take a look at [DevBot](https://github.com/pimterry/dev-bot) for more info on how to build bots themselves. For the rest of this readme, I'm going to assume you're totally on that, and you've got at least the start of a bot ready and waiting.

## Getting Started

With your bot ready, install the DevBot tool:

```javascript
npm install --save-dev dev-bot-tool
```

Note that this doesn't automatically put `dev-bot` in your PATH. You can install it globally to do that, but typically instead I install it locally in my bots, and run the commands below from NPM scripts (which automatically include `./node_modules/bin`, where a locally installed DevBot CLI tool lives, in their PATH) with the relevant arguments pre-prepared.

Check out JokeBot's [package.json](https://github.com/jokebot/jokebot/blob/master/package.json) for an example of this all put together.

### Local manual testing

To quickly run your bot locally, simply run:

```bash
dev-bot run-once
```

This starts up the bot on your machine, does a quick run to check for mentions or other immediate actions, and then shuts down again.

Typically you'll want it to connect to Github, which means it'll need to make a call to `devBot.connectGithub` with some credentials. Rather than hardcoding these, you should pull from `process.env` - see [environmental variables](#environmental-variables) below for details on how to do this nicely.

### Deployment

To actually deploy your bot, you'll need an AWS account, and your AWS credentials in the environment. For many projects you'll want to do this with a .env file in the root of your repo (**remember to .gitignore it!**) and with `source .env` before these your commands. To quickly test this though you can just run:

```bash
export AWS_ACCESS_KEY_ID=AAAAAAAAAAAAAA
export AWS_SECRET_ACCESS_KEY=BBBBBBBBBBBBBBBBBBBBBBBBBBBBB

dev-bot aws-deploy myBotName
```

See [the full aws-deploy documentation](#aws-deploy-botname) below for more details about this command.

## Commands

#### `dev-bot aws-deploy [botName]`

Deploys a given bot to AWS. At a minimum it needs a name for the bot. This bundles up the codebase, with its production dependencies and some DevBot wrapper code, uploads it to AWS Lambda, and starts it. The codebase is assumed to be everything in your current directory (configurable with `--root`), and the `main` file in the first package.json found is assumed to be your DevBot entrypoint (configurable with `--entrypoint`).

If a bot with the same name exists, it is replaced. If you don't specify a role with `--role [roleName]`, or the role you do specify doesn't exist, one is automatically created with default permissions. If you need more permissions, just edit the role (`autogenerated-dev-bot-role`, by default) in the AWS console. By default, bots are created in `eu-west-1`, but you can specify a different region with `--region [regionName]` when deploying.

As with all commands here, you can specify a file of environmental variables that you'd like to be available to this bot at runtime with `--env`. See [environmental variables](#environmental-variables) for more details. AWS Lambda doesn't actually directly support specifying environmental variables, so here your variables are automatically loaded on deploy by [dotenv](https://npmjs.com/package/dotenv), added to the deployed bundle's config, then loaded into `process.env` at runtime later, before your bot is loaded.

## More details

### Environmental variables

You will almost always have some values that you don't want to hardcode into your project, but you do want to use when running your bot locally, or when deploying it. Your Github authentication token and login details for other services you might be talking to are easy examples.

This tool has support for handling environmental variables built in. To make variables available to your bot when executing or deploying it, create a file in dotenv format (KEY=VALUE, newline separated) and pass it on the command line with `--env`. It's strongly recommended you include this file in your .gitignore, so you don't accidentally commit it.

For example:

*bot.env*

```
GITHUB_TOKEN=123abc
MORE_SECRETS=secret!
```

You can deploy this with `dev-bot aws-deploy myBot --env bot.env`, or run it locally with `dev-bot run-local --env bot.env`. Inside your bot GITHUB_TOKEN and MORE_SECRETS will be available in `process.env`.

